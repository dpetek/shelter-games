{% extends "base/layout.html" %}

{% block title %}Shelter Games{% endblock %}

{% block styles %}
    {{ super() }}
{% endblock %}

{% block scripts %}
    {{ super() }}

    <script type="application/javascript">
        $(document).ready(function(){
            $('#toggle-answer').click(function() {
                $.ajax({
                    url: "{{ url_for('wits_advance') }}",
                    type: "POST",
                    dataType: "json",
                    data: {"board_id": "{{ board.id }}", "from_phase": 2 },
                    success: function(data) {
                        if (data.error) {
                            $("#error-alert").text(data.error).show();
                            return;
                        }
                        location.reload(true);
                    },
                    error: function(data) { 
                        $("#error-alert").text(data.error).show();
                    }
                }); 
            });
            $('#skip-question').click(function() {
                $.ajax({
                    url: "{{ url_for('wits_skip') }}",
                    type: "POST",
                    dataType: "json",
                    data: {"id": $(this).attr("value") },
                    success: function(data) {
                        if (data.error) {
                            $("#error-alert").text(data.error).show();
                            return;
                        }
                        location.reload(true);
                    },
                    error: function(data) { 
                        $("#error-alert").text(data.error).show();
                    }
                }); 
            });
            $('#answer-question').click(function() {
                $.ajax({
                    url: "{{ url_for('wits_answer') }}",
                    type: "POST",
                    dataType: "json",
                    data: {"answer_value": $("#answer-value").val(), "board_id": "{{ board.id }}" },
                    success: function(data) {
                        if (data.error) {
                            $("#error-alert").text(data.error).show();
                            return;
                        }
                        location.reload(true);
                    },
                    error: function(data) { 
                        $("#error-alert").text(data.error).show();
                    }
                }); 
            });

            $('#finalize-answers').click(function() {
                $.ajax({
                    url: "{{ url_for('wits_advance') }}",
                    type: "POST",
                    dataType: "json",
                    data: {"board_id": "{{ board.id }}", "from_phase": 1 },
                    success: function(data) {
                        if (data.error) {
                            $("#error-alert").text(data.error).show();
                            return;
                        }
                        location.reload(true);
                    },
                    error: function(data) { 
                        $("#error-alert").text(data.error).show();
                    }
                }); 
            });
            
            $('.answer-bet').click(function() {
                $.ajax({
                    url: "{{ url_for('wits_bet') }}",
                    type: "POST",
                    dataType: "json",
                    data: {"board_id": "{{ board.id }}",
                           "amount": $(this).attr("amount"), 
                           "answer_id": $(this).attr("answer")},
                    success: function(data) {
                        if (data.error) {
                            $("#bet-error").text(data.error).show();
                            return;
                        }
                    },
                    error: function(data) { 
                        $("#bet-error").text(data.error).show();
                    }
                }); 
            });

            {% if board.phase == 1 %}
                setInterval(function(){
                    $("#answers-panel").load(location.href + " #answers-panel");
                }, 3000);
            {% endif %}

        });
    </script>
{% endblock %}

{% block main_content %}
{{ super() }}

<div class="row">
    <div class="col-lg-1">&nbsp;</div>
    <div class="col-lg-10">
        <div class="alert alert-danger hidden" id="error-alert" role="alert"></div>
        <div class="panel panel-default" id="active-question-panel">
            <div class="panel-heading">
                {% if board.phase == 1 %} Question {% else %} Answer {% endif %}
            </div>
            <div class="panel-body">
                <div class="col-sm-2">&nbsp;</div>
                <div class="col-sm-8">
                    {% if board.phase == 1 %}
                        <div class="row" id="question-div">
                            <img src="{{ question_file }}" width="100%" />
                        </div>
                    {% else %}
                        <div class="row" id="answer-div">
                            <img src="{{ answer_file }}" width="100%" />
                        </div>
                    {% endif %}
                </div>
                <div class="col-sm-2">&nbsp;</div>
            </div>
        </div>
    </div>
    <div class="col-lg-1">&nbsp;</div>
</div>

<div class="row">
    <div class="col-lg-1">&nbsp;</div>
    <div class="col-lg-10">
        <div class="alert alert-danger hidden" id="error-alert" role="alert"></div>
        <div class="panel panel-default" id="active-question-panel">
            <div class="panel-heading">
                Your Answer
            </div>
            <div class="panel-body">
                <div class="col-sm-2">&nbsp;</div>
                <div class="col-sm-8">
                    {% if my_answer %}
                    <h4 class="alert alert-warning">Your answer is {{ my_answer.answer }}</h4>
                    {% else %}
                            <div class="input-group">
                                <input type="text" class="form-control {% if board.phase != 1 %}disabled{% endif %}" id="answer-value" placeholder="What's your answer?" {% if board.phase != 1 %}disabled{% endif %}>
                                <span class="input-group-btn">
                                    <button class="btn btn-default {% if board.phase != 1 %}disabled{% endif %}" type="button" id="answer-question">Answer</button>
                                </span>
                            </div><!-- /input-group -->
                    {% endif %}
                </div>
                <div class="col-sm-2">&nbsp;</div>
            </div>
        </div>
    </div>
    <div class="col-lg-1">&nbsp;</div>
</div>

<div class="row">
    <div class="col-lg-1">&nbsp;</div>
    <div class="col-lg-10">
        <div class="alert alert-danger hidden" id="error-alert" role="alert"></div>
        <div class="panel panel-default" id="answers-panel">
            <div class="panel-heading">
                Answers & Betting
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="alert alert-error collapse" id="bet-error"></div>
                    <div class="alert alert-info">You can bet up to 20 chips.</div>

                    {% for ans in all_answers %}
                    <!-- Thumbnail begin -->
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <div class="caption">
                                <h3>{{ ans.user.name }} </h3>
                                    {% if board.phase == 1 %}
                                        <p>Answered and waiting...</p>
                                    {% else %}
                                    <p>Answer: <span class="label label-info">{{ ans.answer }}</span></p>
                                    {% endif %}
                                {% if board.phase == 2 %}
                                    <a class="btn btn-default answer-bet" amount=1  answer="{{ ans.id }}" role="button">+1</a>
                                    <a class="btn btn-default answer-bet" amount=5  answer="{{ ans.id }} "role="button">+5</a>
                                    <a class="btn btn-default answer-bet" amount=10 answer="{{ ans.id }}" role="button">+10</a>
                                </p>
                                <div class="row">
                                    {% for bet in game_bets %}
                                        {% if bet.answer_id == ans.id %}
                                        <span class="label label-info">{{bet.user.name}} {{bet.amount}} {{ bet.answer_id }}</span>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <!-- Thumbnail end -->
                    {% endfor %}

                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-1">&nbsp;</div>
</div>

<div class="row">
    <div class="col-lg-2">&nbsp;</div>
    <div class="col-lg-8">
        <div class="alert alert-danger hidden" id="error-alert" role="alert"></div>
        {% if session["user"]["admin"] > 0 %}
        <div class="panel panel-default">
            <div class="panel-heading">
                Admin Actions
            </div>
            <div class="panel-body">
                <div class="col-lg-4">
                    <div class="input-group">
                        <input type="text" class="form-control" id="game-name" placeholder="Game Name ...">
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-default" value="{{game["id"]}}" aria-label="Left Align">
                                <span class="glyphicon glyphicon-forward" aria-hidden="true"></span> Input Answer
                            </button>
                        </span>
                    </div><!-- /input-group -->
                </div>
                <div class="col-lg-4">
                    <button type="button" class="btn btn-default {% if board.phase != 1 %}disabled{% endif %}" value="{{board["id"]}}" id="finalize-answers" aria-label="Left Align">
                        <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span> Finalize Answers
                    </button>
                </div>
                <div class="col-lg-4">
                    <button type="button" class="btn btn-default" value="{{game["id"]}}" id="toggle-answer" aria-label="Left Align">
                        <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span> Toggle Answer
                    </button>
                    <button type="button" class="btn btn-default" value="{{game["id"]}}" id="skip-question" aria-label="Left Align">
                        <span class="glyphicon glyphicon-fast-forward" aria-hidden="true"></span> Skip Question
                    </button>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    <div class="col-lg-2">&nbsp;</div>
</div>

{% endblock %}
